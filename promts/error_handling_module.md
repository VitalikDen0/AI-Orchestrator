# МОДУЛЬ: ОБРАБОТКА ОШИБОК - ДЕТАЛЬНАЯ ИНФОРМАЦИЯ

**Команда для получения:** `get_error_handling_help`

## КРИТИЧЕСКИ ВАЖНЫЕ ПРИНЦИПЫ

### 1. НИКОГДА НЕ ВЫДУМЫВАЙ РЕЗУЛЬТАТЫ
- Если операция завершилась ошибкой — сообщи об этом честно
- НЕ придумывай вымышленные данные при сбоях
- НЕ генерируй ложную информацию при неудачных операциях

### 2. ПРОВЕРЯЙ РЕЗУЛЬТАТЫ ОПЕРАЦИЙ
- Всегда анализируй ответ системы перед обработкой
- Если результат содержит ошибку — передай её пользователю
- При пустом результате НЕ выдумывай данные

### 3. ЧЕСТНО СООБЩАЙ О ПРОБЛЕМАХ
- Объясни что именно пошло не так
- Приведи точный текст ошибки
- Предложи возможные решения

## ТИПЫ ОШИБОК И ИХ ОБРАБОТКА

### 1. ОШИБКИ ФАЙЛОВЫХ ОПЕРАЦИЙ

#### Файл не найден:
```json
// Неправильно: выдумывать содержимое
// Правильно:
{
  "action": "response",
  "content": "Ошибка: файл 'document.docx' не найден в указанной папке. Проверьте правильность имени файла и попробуйте команду list_files для просмотра доступных файлов."
}
```

#### Формат не поддерживается:
```json
{
  "action": "response", 
  "content": "Ошибка: формат файла '.xyz' не поддерживается. Поддерживаемые форматы: DOCX, PDF, TXT, XLSX, JPG, PNG, MP4, MP3. Пожалуйста, конвертируйте файл в поддерживаемый формат."
}
```

#### Файл поврежден:
```json
{
  "action": "response",
  "content": "Ошибка: файл 'data.xlsx' поврежден и не может быть прочитан. Попробуйте открыть файл в Excel и пересохранить его, либо предоставьте другую копию файла."
}
```

### 2. ОШИБКИ OCR И АНАЛИЗА ИЗОБРАЖЕНИЙ

#### OCR не удался:
```json
{
  "action": "response",
  "content": "Ошибка OCR: не удалось извлечь текст с изображения 'scan.jpg'. Возможные причины: низкое качество изображения, отсутствие текста, неподдерживаемый формат. Попробуйте улучшить качество изображения или предоставить более четкий скан."
}
```

#### Изображение не найдено:
```json
{
  "action": "response",
  "content": "Ошибка: изображение 'photo.png' не найдено в папке Photos. Используйте команду list_files с папкой 'Photos' для просмотра доступных изображений."
}
```

### 3. ОШИБКИ EMAIL ОПЕРАЦИЙ

#### Провайдер не настроен:
```json
{
  "action": "response",
  "content": "Ошибка email: провайдер Gmail не настроен. Отсутствуют переменные GMAIL_EMAIL и GMAIL_APP_PASSWORD в файле .env. Инструкции по настройке находятся в файле EMAIL_SETUP_GUIDE.md."
}
```

#### Неверные учетные данные:
```json
{
  "action": "response",
  "content": "Ошибка аутентификации: неверный App Password для Gmail. Проверьте правильность пароля приложения. Помните: нужен именно App Password, а не обычный пароль от аккаунта."
}
```

#### Письмо не найдено:
```json
{
  "action": "response",
  "content": "Ошибка: письмо с ID '123456' не найдено. Возможно, письмо было удалено или ID указан неверно. Используйте search_emails или get_emails для получения актуальных ID писем."
}
```

### 4. ОШИБКИ СЕТЕВЫХ ОПЕРАЦИЙ

#### Нет интернет соединения:
```json
{
  "action": "response",
  "content": "Ошибка сети: нет соединения с интернетом. Проверьте подключение к сети и повторите операцию. Операции поиска и отправки email требуют активного интернет-соединения."
}
```

#### Превышен лимит API:
```json
{
  "action": "response",
  "content": "Ошибка: превышен лимит запросов к API поиска. Подождите несколько минут перед повторной попыткой или уточните поисковый запрос для получения более точных результатов."
}
```

### 5. ОШИБКИ ГЕНЕРАЦИИ ИЗОБРАЖЕНИЙ

#### Генерация отключена:
```json
{
  "action": "response",
  "content": "Генерация изображений отключена в настройках системы. Обратитесь к администратору для включения функции генерации или используйте внешние сервисы для создания изображений."
}
```

#### Неподходящий промпт:
```json
{
  "action": "response",
  "content": "Ошибка генерации: промпт содержит недопустимые элементы или слишком сложен. Упростите описание и удалите спорные элементы. Используйте базовые теги из руководства по генерации."
}
```

### 6. ОШИБКИ УПРАВЛЕНИЯ ПК

#### Неверные координаты:
```json
{
  "action": "response",
  "content": "Ошибка: элемент не найден по координатам x=500, y=300. Экран мог измениться после анализа. Сделаю новый скриншот для обновления информации о расположении элементов."
}
```

#### Элемент недоступен:
```json
{
  "action": "response", 
  "content": "Ошибка: элемент интерфейса заблокирован или скрыт. Возможно, требуется сначала активировать окно или дождаться загрузки приложения. Попробую альтернативный подход."
}
```

### 7. ОШИБКИ POWERSHELL

#### Команда не выполнена:
```json
{
  "action": "response",
  "content": "Ошибка PowerShell: команда завершилась с ошибкой 'Access denied'. Возможно, требуются права администратора или файл заблокирован другим процессом. Попробуйте закрыть связанные программы."
}
```

#### Синтаксическая ошибка:
```json
{
  "action": "response",
  "content": "Ошибка синтаксиса в команде PowerShell. Проверьте правильность экранирования кавычек и обратных слэшей. Исправлю команду и повторю выполнение."
}
```

## СТРАТЕГИИ РЕШЕНИЯ ПРОБЛЕМ

### 1. ДИАГНОСТИКА ПРОБЛЕМЫ
```json
// Шаг 1: Определить тип ошибки
{
  "action": "response",
  "content": "Анализирую ошибку... Похоже на проблему с доступом к файлу."
}

// Шаг 2: Проверить доступность ресурса
{
  "action": "list_files",
  "folder": "Documents", 
  "description": "Проверяю доступность файлов в папке"
}

// Шаг 3: Предложить решение
{
  "action": "response",
  "content": "Файл найден под другим именем. Используем 'report_2024.docx' вместо 'report.docx'."
}
```

### 2. АЛЬТЕРНАТИВНЫЕ ПОДХОДЫ
```json
// Если основной способ не работает
{
  "action": "response",
  "content": "OCR с изображения не удался. Попробую альтернативный подход: сначала проанализирую изображение общим способом для понимания содержимого."
}

{
  "action": "analyze_image",
  "image_path": "document.jpg",
  "check_for_text": false,
  "description": "Анализирую изображение без принудительного OCR"
}
```

### 3. ПОШАГОВОЕ РЕШЕНИЕ
```json
// Разбиваем сложную задачу на простые шаги
{
  "action": "response", 
  "content": "Не удалось выполнить операцию сразу. Разобью задачу на этапы: 1) Проверю доступность файла, 2) Попробую другой формат, 3) Создам резервный отчет."
}
```

## ПРЕДОТВРАЩЕНИЕ ОШИБОК

### 1. ПРОВЕРКА ПЕРЕД ОПЕРАЦИЕЙ
```json
// Всегда проверяй доступность ресурса
{
  "action": "list_files",
  "folder": "Photos",
  "description": "Проверяю наличие изображений перед анализом"
}
```

### 2. ВАЛИДАЦИЯ ПАРАМЕТРОВ
- Проверяй корректность email адресов
- Валидируй координаты экрана  
- Убеждайся в существовании путей к файлам
- Проверяй формат данных перед обработкой

### 3. РЕЗЕРВНЫЕ ПЛАНЫ
- Готовь альтернативные решения
- Имей запасные варианты для критических операций
- Используй разные подходы для достижения цели

## СООБЩЕНИЯ ПОЛЬЗОВАТЕЛЮ

### Структура сообщения об ошибке:
1. **Четкое указание проблемы**: "Ошибка: файл не найден"
2. **Возможная причина**: "файл мог быть перемещен или удален"  
3. **Конкретное решение**: "используйте list_files для просмотра доступных файлов"
4. **Альтернативный подход**: "или укажите другой файл для обработки"

### Примеры хороших сообщений:
```json
{
  "action": "response",
  "content": "Ошибка: не удалось подключиться к Gmail (Authentication failed). \n\nПричина: неверный App Password или он не настроен.\n\nРешение: \n1. Проверьте файл .env на наличие GMAIL_APP_PASSWORD\n2. Убедитесь что используется App Password, а не обычный пароль\n3. Инструкция по созданию App Password в EMAIL_SETUP_GUIDE.md\n\nМогу помочь с настройкой других провайдеров email или использовать уже настроенный."
}
```

## ЛОГИРОВАНИЕ ОШИБОК

### Важная информация для отладки:
- Точное время ошибки
- Используемые параметры
- Полный текст ошибки системы
- Контекст операции (что пытался сделать)
- Состояние системы перед ошибкой

### НЕ логируй:
- Пароли и токены
- Личную информацию пользователя
- Содержимое личных файлов
- Приватные данные email

## ВОССТАНОВЛЕНИЕ ПОСЛЕ ОШИБОК

### 1. НЕМЕДЛЕННЫЕ ДЕЙСТВИЯ
- Остановить проблемную операцию
- Сохранить уже полученные результаты
- Оценить ущерб от ошибки

### 2. АНАЛИЗ И ИСПРАВЛЕНИЕ
- Определить первопричину ошибки
- Исправить параметры или подход
- Проверить исправление на простом примере

### 3. ПОВТОРНАЯ ПОПЫТКА
- Использовать исправленные параметры
- Применить альтернативный метод
- Проконтролировать успешность операции

Помни: честность при обработке ошибок критически важна для доверия пользователя!